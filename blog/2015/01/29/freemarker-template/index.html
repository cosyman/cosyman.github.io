<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>FreeMarker Template &middot; 兰天</title>

  
  <link rel="stylesheet" href="http://cosyman.github.io/css/poole.css">
  <link rel="stylesheet" href="http://cosyman.github.io/css/hyde.css">
  <link rel="stylesheet" href="http://cosyman.github.io/css/poole-overrides.css">
  <link rel="stylesheet" href="http://cosyman.github.io/css/hyde-overrides.css">
  <link rel="stylesheet" href="http://cosyman.github.io/css/hyde-x.css">
  <link rel="stylesheet" href="http://cosyman.github.io/css/highlight/sunburst.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://cosyman.github.io/apple-touch-icon-144-precomposed.png">
  <link href="http://cosyman.github.io/favicon.png" rel="icon">

  
  
  
  

  <meta name="description" content="Your default page description">
  <meta name="keywords" content="cosyman,bluesky">
  <link rel="author" href="http://plus.google.com/Your%20Google&#43;%20profile%20ID">
</head>
<body class="layout-reverse">
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <img src="https://secure.gravatar.com/avatar/29bea2982cf098795915166d7a907376?s=160" alt="gravatar">
      <h1>兰天</h1>
      <p class="lead">优雅的活着</p>
    </div>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item"><a href="http://cosyman.github.io/">Blog</a></li>
      
    </ul>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item">
      <a href="http://github.com/cosyman"><i class="fa fa-github-square fa-2x"></i></a>
      
      <a href="https://www.linkedin.com/in/blueskyyao"><i class="fa fa-linkedin-square fa-2x"></i></a>
      
      
      <a href="https://twitter.com/bluesky_yao"><i class="fa fa-twitter-square fa-2x"></i></a>
      </li>
    </ul>

    <p>Copyright &copy; 2015 <a href="http://cosyman.github.io/license/">License</a><br/>
       Powered by <a href="http://gohugo.io">Hugo</a> and <a href="https://github.com/zyro/hyde-x">Hyde-X</a></p>
  </div>
</div>


<div class="content container">
  <div class="post">
    <h1>FreeMarker Template</h1>
    <span class="post-date">Jan 29, 2015 &middot; 1 minute read &middot; <a href="http://cosyman.github.io/blog/2015/01/29/freemarker-template/#disqus_thread">Comments</a>
    
    <br/>
    <a class="label" href="http://cosyman.github.io/categories/technology">technology</a>
    </span>
    

<p>Java中不乏优秀的模板引擎，Velocity,
<a href="https://github.com/mvel/mvel[mvel],FreeMarker等。在构建框架的时候，通常可以拿来即用，但我们需要控制它。最近需要一个数据准备的框架，便选择了FreeMarker，FreeMarker使用起来很简单，data+template=out.今天主要写一下其中template加载组件TemplateLoader">https://github.com/mvel/mvel[mvel],FreeMarker等。在构建框架的时候，通常可以拿来即用，但我们需要控制它。最近需要一个数据准备的框架，便选择了FreeMarker，FreeMarker使用起来很简单，data+template=out.今天主要写一下其中template加载组件TemplateLoader</a></p>

<h2 id="templateloader的实现:f0ce66837e1e420c9d8011dfac968f38">TemplateLoader的实现</h2>

<p>作为一个模板文件加载的抽象，自然不能限制模板来自何方，在FreeMarker中由几个主要的实现类来体现，这些TemplateLoader是可以独立使用的，Webapp需要Servlet环境。当然你可以实现自己的TemplateLoader.</p>

<ul>
<li>StringTemplateLoader 直接将内存中的String对象放入并使用</li>
<li>FileTemplateLoader 本地文件目录</li>
<li>ClassTemplateLoader ClassPath 加载</li>
<li>WebappTemplateLoader  ServletContext</li>
<li>MultiTemplateLoader 多个TemplateLoader的叠加，顺序按照数组的顺序优先加载</li>
</ul>

<h3 id="stringtemplateloader:f0ce66837e1e420c9d8011dfac968f38">StringTemplateLoader</h3>

<p>刚开始总觉得StringTemplateLoader简单，其实挺麻烦，而且也无大用。</p>

<pre><code class="language-java">@Test
public void testStringTL() throws IOException {
	StringTemplateLoader stl = new StringTemplateLoader();
	String template = &quot;${key}&quot;;
	stl.putTemplate(&quot;hello&quot;, template);
	Object source = stl.findTemplateSource(&quot;hello&quot;);
	Reader reader = stl.getReader(source, &quot;utf-8&quot;);
	String dest = IOUtils.toString(reader);
	Assert.assertEquals(template, dest);

}
</code></pre>

<h3 id="multitemplateloader:f0ce66837e1e420c9d8011dfac968f38">MultiTemplateLoader</h3>

<p>TemplateLoader是可以多种类型，同种类型组合起来使用的，查询顺序按照数组的顺序优先。</p>

<pre><code class="language-java">@Test
public void testMultiTL() throws IOException {
	TemplateLoader ctl = new ClassTemplateLoader(TemplateLoaderTest.class,
			&quot;/&quot;);
	TemplateLoader ftl1 = new FileTemplateLoader(new File(
			System.getProperty(&quot;user.dir&quot;)));
	MultiTemplateLoader mtl = new MultiTemplateLoader(new TemplateLoader[] {
			ftl1,ctl  });

	Object source = mtl.findTemplateSource(&quot;test.ftl&quot;);
	Reader reader = mtl.getReader(source, &quot;utf-8&quot;);
	String dest = IOUtils.toString(reader);
	Assert.assertEquals(&quot;${hello}&quot;, dest);
}
</code></pre>

<h2 id="通常在configuration中使用-才能方便的处理freemarker的表达式:f0ce66837e1e420c9d8011dfac968f38">通常在Configuration中使用，才能方便的处理FreeMarker的表达式</h2>

<pre><code class="language-java">@Test
public void testInConfiguration() throws IOException {
	Configuration configuration = new Configuration(
			Configuration.VERSION_2_3_21);
	configuration.setDefaultEncoding(&quot;utf-8&quot;);
	TemplateLoader ctl = new ClassTemplateLoader(TemplateLoaderTest.class,
			&quot;/&quot;);
	TemplateLoader ftl1 = new FileTemplateLoader(new File(
			System.getProperty(&quot;user.dir&quot;)));
	MultiTemplateLoader mtl = new MultiTemplateLoader(new TemplateLoader[] {
			ftl1,ctl });
	configuration.setTemplateLoader(mtl);
	//configuration.getTemplate(&quot;test.ftl&quot;).process(data, out);
}

</code></pre>

<h2 id="其它:f0ce66837e1e420c9d8011dfac968f38">其它</h2>

<h3 id="缓存:f0ce66837e1e420c9d8011dfac968f38">缓存</h3>

<p>模板加载通常是耗费资源的，默认是开启缓存的，缓存的实现，是否使用缓存取决于你</p>

<pre><code class="language-java">configuration.setCacheStorage(new freemarker.cache.NullCacheStorage());

configuration.clearTemplateCache();
</code></pre>

  </div>
  <div id="disqus_thread"></div>
</div>


<script type="text/javascript">
var disqus_shortname = "cosyman";
(function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>



<script type="text/javascript">
    var disqus_shortname = "cosyman";
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

<script src="http://cosyman.github.io/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script>
  var _gaq=[['_setAccount','UA-64429204-1'],['_trackPageview']];
  (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
  g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
  s.parentNode.insertBefore(g,s)}(document,'script'));
</script>

</body>
</html>

